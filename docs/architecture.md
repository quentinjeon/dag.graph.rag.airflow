# GraphRAG 시스템 아키텍처

## 개요

GraphRAG(Graph-based Retrieval Augmented Generation) 시스템은 벡터 데이터베이스와 그래프 데이터베이스를 결합하여 향상된 질의응답 기능을 제공합니다. 이 시스템은 의미적 검색과 구조화된 지식 탐색을 통합하여 보다 정확하고 컨텍스트가 풍부한 응답을 생성합니다.

## 아키텍처 다이어그램

```
┌─────────────────┐          ┌─────────────────┐         ┌─────────────────┐
│                 │          │                 │         │                 │
│    사용자 질문    │──────────▶│   Express 서버   │◀────────▶│   OpenAI API    │
│                 │          │                 │         │                 │
└─────────────────┘          └────────┬────────┘         └─────────────────┘
                                      │
                                      │
                                      ▼
                     ┌────────────────┴─────────────────┐
                     │                                  │
                     │                                  │
         ┌───────────▼─────────────┐        ┌───────────▼─────────────┐
         │                         │        │                         │
         │  Weaviate (벡터 검색)    │        │   Neo4j (그래프 검색)    │
         │                         │        │                         │
         └─────────────────────────┘        └─────────────────────────┘
                     ▲                                    ▲
                     │                                    │
                     │                                    │
                     └────────────────┬──────────────────┘
                                      │
                                      │
                                      ▼
                            ┌─────────────────┐
                            │                 │
                            │     Airflow     │
                            │                 │
                            └─────────────────┘
```

## 컴포넌트 설명

### 1. Express 서버 (API 레이어)

Express 서버는 시스템의 중심 컴포넌트로, 다음 역할을 수행합니다:

- 사용자 질문 수신 (`/api/chat` 엔드포인트)
- GraphRAG 워크플로우 조정
- 벡터 검색 및 그래프 검색 통합
- OpenAI API 호출을 통한 응답 생성
- 시스템 상태 모니터링 (`/health` 엔드포인트)

### 2. Weaviate (벡터 데이터베이스)

Weaviate는 텍스트 문서의 벡터 표현을 저장하고 검색합니다:

- OpenAI 임베딩 모델을 사용한 텍스트 벡터화
- 의미적 유사성 기반 문서 검색
- 문서 콘텐츠 및 메타데이터 저장
- 자연어 질문에 대한 관련 문서 검색

### 3. Neo4j (그래프 데이터베이스)

Neo4j는 개념 간의 관계를 저장하고 탐색합니다:

- 도메인 개념을 노드로 표현
- 개념 간의 관계를 엣지로 표현
- Cypher 쿼리 언어를 통한 그래프 탐색
- 질문에서 추출된 엔티티를 시작점으로 하는 관련 지식 검색

### 4. OpenAI API

OpenAI API는 자연어 처리 기능을 제공합니다:

- 텍스트의 벡터 임베딩 생성
- 엔티티 추출 및 텍스트 분석
- 검색 결과를 바탕으로 한 응답 생성
- 사용자 질문 이해 및 분석

### 5. Airflow

Airflow는 데이터 처리 및 워크플로우 자동화를 담당합니다:

- 질의응답 프로세스 자동화
- 워크플로우 실행 스케줄링
- 작업 결과 모니터링 및 오류 처리
- 통계 및 로그 수집

## 데이터 흐름

1. **사용자 질문 수신**:
   - 사용자가 `/api/chat` 엔드포인트로 질문을 전송합니다.
   - Express 서버가 질문을 수신하고 처리를 시작합니다.

2. **벡터 검색 (Weaviate)**:
   - 질문을 OpenAI API를 통해 벡터로 변환합니다.
   - Weaviate에서 유사한 문서를 검색합니다.
   - 관련성이 높은 상위 3개 문서를 선택합니다.

3. **엔티티 추출**:
   - OpenAI API를 사용하여 질문에서 핵심 엔티티를 추출합니다.
   - 추출된 엔티티를 그래프 탐색의 시작점으로 사용합니다.

4. **그래프 검색 (Neo4j)**:
   - 추출된 엔티티를 Neo4j에서 찾습니다.
   - 관련 노드와 관계를 검색합니다.
   - 최대 3홉 깊이까지 그래프를 탐색합니다.

5. **컨텍스트 통합**:
   - 벡터 검색 결과와 그래프 검색 결과를 통합합니다.
   - 중복 정보를 제거하고 관련성에 따라 정렬합니다.

6. **응답 생성**:
   - 통합된 컨텍스트를 OpenAI API에 전달합니다.
   - API가 자연어 응답을 생성합니다.
   - 응답과 소스 정보를 클라이언트에 반환합니다.

7. **결과 저장 (선택적)**:
   - Airflow DAG를 통해 질문, 응답, 소스를 데이터베이스에 저장합니다.
   - 향후 분석 및 시스템 개선을 위한 데이터를 수집합니다.

## 확장 가능성

이 아키텍처는 다음과 같은 방향으로 확장할 수 있습니다:

1. **다중 벡터 데이터베이스 통합**:
   - 여러 도메인별 벡터 데이터베이스 추가
   - 소스별 검색 가중치 조정

2. **다중 그래프 연결**:
   - 여러 도메인 그래프 통합
   - 크로스 도메인 관계 탐색

3. **캐싱 레이어 추가**:
   - 자주 묻는 질문에 대한 응답 캐싱
   - 임베딩 계산 결과 캐싱

4. **실시간 학습 피드백 루프**:
   - 사용자 피드백 기반 응답 개선
   - 응답 품질 모니터링 및 자동 개선

5. **분산 처리**:
   - 대용량 질의 처리를 위한 수평적 확장
   - 마이크로서비스 아키텍처로의 전환

## 보안 고려사항

1. **API 인증**:
   - 모든 API 엔드포인트에 인증 추가
   - Rate limiting 구현

2. **데이터 암호화**:
   - 민감한 질문 및 응답 데이터 암호화
   - 전송 중 데이터 보호 (HTTPS)

3. **액세스 제어**:
   - 데이터베이스 접근 권한 관리
   - 사용자 역할 기반 기능 제한

## 성능 최적화

1. **벡터 검색 최적화**:
   - 인덱스 튜닝
   - 벡터 차원 최적화
   - 검색 결과 수 제한

2. **그래프 쿼리 최적화**:
   - 인덱스 생성
   - 쿼리 캐싱
   - 탐색 깊이 제한

3. **응답 지연 시간 감소**:
   - 비동기 처리
   - 병렬 검색
   - 연산 분산 